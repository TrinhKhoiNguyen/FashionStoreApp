# ğŸ Admin Panel - Quáº£n lÃ½ Voucher

## Tá»•ng quan

Module quáº£n lÃ½ voucher cho phÃ©p admin táº¡o, chá»‰nh sá»­a, xÃ³a vÃ  theo dÃµi cÃ¡c voucher giáº£m giÃ¡. Há»‡ thá»‘ng há»— trá»£ Ä‘áº§y Ä‘á»§ cÃ¡c loáº¡i voucher phá»• biáº¿n trong thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­.

---

## ğŸ¯ TÃ­nh nÄƒng chÃ­nh

### 1. **Danh sÃ¡ch Voucher**
- âœ… Hiá»ƒn thá»‹ táº¥t cáº£ voucher vá»›i Ä‘áº§y Ä‘á»§ thÃ´ng tin
- ğŸ” TÃ¬m kiáº¿m theo mÃ£ voucher
- ğŸ·ï¸ Lá»c theo:
  - Táº¥t cáº£
  - Active (Ä‘ang hoáº¡t Ä‘á»™ng)
  - Inactive (Ä‘Ã£ táº¯t)
  - Háº¿t háº¡n
  - Giáº£m % (Percent)
  - Giáº£m cá»‘ Ä‘á»‹nh (Fixed)
- ğŸ“Š Hiá»ƒn thá»‹ tráº¡ng thÃ¡i vá»›i mÃ u sáº¯c:
  - ğŸŸ¢ **Active**: Voucher Ä‘ang hoáº¡t Ä‘á»™ng
  - ğŸ”´ **Háº¿t háº¡n**: Voucher Ä‘Ã£ quÃ¡ háº¡n sá»­ dá»¥ng
  - ğŸŸ  **Háº¿t lÆ°á»£t**: Voucher Ä‘Ã£ háº¿t sá»‘ lÆ°á»£ng
  - âšª **Inactive**: Voucher bá»‹ vÃ´ hiá»‡u hÃ³a

### 2. **ThÃ´ng tin Voucher**
Má»—i voucher hiá»ƒn thá»‹:
- **MÃ£ voucher**: CODE (viáº¿t hoa)
- **Loáº¡i**: Giáº£m cá»‘ Ä‘á»‹nh hoáº·c giáº£m %
- **GiÃ¡ trá»‹**: Sá»‘ tiá»n hoáº·c % giáº£m
- **Giáº£m tá»‘i Ä‘a**: Chá»‰ Ã¡p dá»¥ng cho loáº¡i giáº£m %
- **ÄÆ¡n tá»‘i thiá»ƒu**: GiÃ¡ trá»‹ Ä‘Æ¡n hÃ ng tá»‘i thiá»ƒu Ä‘á»ƒ Ã¡p dá»¥ng
- **Sá»‘ lÆ°á»£ng**: CÃ²n láº¡i / Tá»•ng sá»‘ (vá»›i mÃ u cáº£nh bÃ¡o)
- **Thá»i háº¡n**: NgÃ y báº¯t Ä‘áº§u - NgÃ y káº¿t thÃºc
- **MÃ´ táº£**: MÃ´ táº£ chi tiáº¿t voucher

### 3. **ThÃªm Voucher Má»›i**

**Form nháº­p liá»‡u:**
- **MÃ£ voucher** *(báº¯t buá»™c)*
  - Viáº¿t hoa, khÃ´ng dáº¥u
  - Ãt nháº¥t 3 kÃ½ tá»±
  - Chá»‰ chá»©a chá»¯ cÃ¡i vÃ  sá»‘
  - KhÃ´ng trÃ¹ng vá»›i voucher khÃ¡c

- **Loáº¡i voucher** *(báº¯t buá»™c)*
  - Giáº£m cá»‘ Ä‘á»‹nh (â‚«)
  - Giáº£m theo % (Percent)

- **GiÃ¡ trá»‹** *(báº¯t buá»™c)*
  - Vá»›i loáº¡i cá»‘ Ä‘á»‹nh: Sá»‘ tiá»n > 0
  - Vá»›i loáº¡i %: Tá»« 1-100

- **Giáº£m tá»‘i Ä‘a**
  - Chá»‰ hiá»ƒn thá»‹ khi chá»n loáº¡i %
  - Giá»›i háº¡n sá»‘ tiá»n giáº£m tá»‘i Ä‘a

- **ÄÆ¡n hÃ ng tá»‘i thiá»ƒu** *(báº¯t buá»™c)*
  - GiÃ¡ trá»‹ Ä‘Æ¡n hÃ ng tá»‘i thiá»ƒu Ä‘á»ƒ Ã¡p dá»¥ng voucher
  - CÃ³ thá»ƒ = 0 (khÃ´ng yÃªu cáº§u)

- **Sá»‘ lÆ°á»£ng** *(báº¯t buá»™c)*
  - Sá»‘ lÆ°á»£ng voucher cÃ³ thá»ƒ sá»­ dá»¥ng
  - Pháº£i > 0

- **NgÃ y báº¯t Ä‘áº§u** *(báº¯t buá»™c)*
  - Chá»n tá»« DatePicker
  - KhÃ´ng Ä‘Æ°á»£c trÆ°á»›c ngÃ y hiá»‡n táº¡i

- **NgÃ y káº¿t thÃºc** *(báº¯t buá»™c)*
  - Chá»n tá»« DatePicker
  - Pháº£i sau ngÃ y báº¯t Ä‘áº§u
  - Pháº£i sau ngÃ y hiá»‡n táº¡i

- **MÃ´ táº£**
  - MÃ´ táº£ chi tiáº¿t vá» voucher (tÃ¹y chá»n)
  - Tá»‘i Ä‘a 200 kÃ½ tá»±

- **Tráº¡ng thÃ¡i**
  - Switch Active/Inactive
  - Máº·c Ä‘á»‹nh: Active

**Validation:**
- âŒ MÃ£ voucher trÃ¹ng
- âŒ GiÃ¡ trá»‹ khÃ´ng há»£p lá»‡
- âŒ NgÃ y khÃ´ng há»£p lÃ½
- âŒ Sá»‘ lÆ°á»£ng <= 0

### 4. **Chá»‰nh sá»­a Voucher**

**LÆ°u Ã½:**
- âœ… CÃ³ thá»ƒ sá»­a táº¥t cáº£ thÃ´ng tin NGOáº I TRá»ª mÃ£ voucher
- âœ… Giá»¯ nguyÃªn sá»‘ lÆ°á»£ng Ä‘Ã£ sá»­ dá»¥ng
- âœ… CÃ³ thá»ƒ kÃ­ch hoáº¡t/vÃ´ hiá»‡u hÃ³a
- âœ… CÃ³ nÃºt xÃ³a voucher

### 5. **XÃ³a Voucher**

**Quy trÃ¬nh:**
1. Click nÃºt **XÃ³a** hoáº·c menu **â‹®** â†’ XÃ³a
2. XÃ¡c nháº­n trong dialog
3. Voucher bá»‹ xÃ³a vÄ©nh viá»…n khá»i Firestore

**âš ï¸ Cáº£nh bÃ¡o:**
- KhÃ´ng thá»ƒ khÃ´i phá»¥c sau khi xÃ³a
- NÃªn vÃ´ hiá»‡u hÃ³a thay vÃ¬ xÃ³a náº¿u voucher Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng

### 6. **KÃ­ch hoáº¡t / VÃ´ hiá»‡u hÃ³a**

**CÃ¡ch thá»±c hiá»‡n:**
- Click nÃºt **KÃ­ch hoáº¡t** / **VÃ´ hiá»‡u hÃ³a**
- Hoáº·c menu **â‹®** â†’ Äá»•i tráº¡ng thÃ¡i
- Voucher inactive sáº½ khÃ´ng thá»ƒ sá»­ dá»¥ng khi checkout

---

## ğŸ“‹ Cáº¥u trÃºc Dá»¯ liá»‡u Firestore

### Collection: `vouchers`

```json
{
  "code": "NEWYEAR2025",
  "type": "percent",
  "amount": 15,
  "maxDiscount": 100000,
  "minOrder": 299000,
  "quantity": 500,
  "usedCount": 123,
  "startAt": 1733011200000,
  "endAt": 1735689599000,
  "active": true,
  "description": "Voucher giáº£m giÃ¡ Ä‘áº§u nÄƒm",
  "createdAt": 1733011200000,
  "updatedAt": 1733011200000
}
```

**Field Types:**
- `code`: String (uppercase, unique)
- `type`: String ("fixed" | "percent")
- `amount`: Number (tiá»n hoáº·c %)
- `maxDiscount`: Number (chá»‰ cho percent)
- `minOrder`: Number (Ä‘Æ¡n tá»‘i thiá»ƒu)
- `quantity`: Number (tá»•ng sá»‘ voucher)
- `usedCount`: Number (sá»‘ Ä‘Ã£ dÃ¹ng)
- `startAt`: Number (epoch milliseconds)
- `endAt`: Number (epoch milliseconds)
- `active`: Boolean
- `description`: String (optional)
- `createdAt`: Number (epoch milliseconds)
- `updatedAt`: Number (epoch milliseconds)

---

## ğŸ”’ Firestore Security Rules

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    function isAdmin() {
      return request.auth != null && 
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    // Vouchers
    match /vouchers/{voucherId} {
      // Everyone can read active vouchers (for checkout)
      allow read: if true;
      
      // Only admin can write
      allow create, update, delete: if isAdmin();
    }
  }
}
```

---

## ğŸ¨ UI Components

### Fragment: `AdminVouchersFragment`
- SearchBar vá»›i real-time filter
- ChipGroup cho filter nhanh
- RecyclerView vá»›i LinearLayoutManager
- FloatingActionButton Ä‘á»ƒ thÃªm voucher
- Empty state khi khÃ´ng cÃ³ voucher

### Activity: `AdminVoucherFormActivity`
- Material Design TextInputLayout
- AutoCompleteTextView cho dropdown loáº¡i voucher
- DatePickerDialog cho chá»n ngÃ y
- SwitchMaterial cho active/inactive
- Validation realtime khi nháº­p

### Adapter: `AdminVoucherAdapter`
- Filter theo query vÃ  type
- Popup menu cho actions
- Color-coded status badges
- Dynamic UI dá»±a trÃªn voucher type

---

## ğŸ’¡ VÃ­ dá»¥ Voucher

### 1. Voucher giáº£m 50.000â‚«
```
MÃ£: SAVE50K
Loáº¡i: Giáº£m cá»‘ Ä‘á»‹nh
GiÃ¡ trá»‹: 50000
ÄÆ¡n tá»‘i thiá»ƒu: 299000
Sá»‘ lÆ°á»£ng: 100
```

### 2. Voucher giáº£m 15%
```
MÃ£: SALE15
Loáº¡i: Giáº£m %
GiÃ¡ trá»‹: 15
Giáº£m tá»‘i Ä‘a: 100000
ÄÆ¡n tá»‘i thiá»ƒu: 500000
Sá»‘ lÆ°á»£ng: 200
```

### 3. Voucher Freeship
```
MÃ£: FREESHIP
Loáº¡i: Giáº£m cá»‘ Ä‘á»‹nh
GiÃ¡ trá»‹: 30000
ÄÆ¡n tá»‘i thiá»ƒu: 0
Sá»‘ lÆ°á»£ng: 500
```

---

## ğŸš€ CÃ¡ch sá»­ dá»¥ng

### BÆ°á»›c 1: Truy cáº­p Admin Panel
1. ÄÄƒng nháº­p vá»›i tÃ i khoáº£n admin
2. VÃ o **Profile** â†’ **Admin Panel**
3. Chá»n tab **Vouchers**

### BÆ°á»›c 2: ThÃªm Voucher
1. Click nÃºt **+** (FAB)
2. Äiá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin
3. Click **LÆ°u Voucher**

### BÆ°á»›c 3: Quáº£n lÃ½ Voucher
- **TÃ¬m kiáº¿m**: GÃµ mÃ£ voucher vÃ o search bar
- **Lá»c**: Click chip Ä‘á»ƒ lá»c nhanh
- **Chá»‰nh sá»­a**: Click nÃºt **Chá»‰nh sá»­a**
- **XÃ³a**: Click menu **â‹®** â†’ XÃ³a
- **Äá»•i tráº¡ng thÃ¡i**: Click nÃºt **KÃ­ch hoáº¡t/VÃ´ hiá»‡u hÃ³a**

---

## âš ï¸ LÆ°u Ã½ quan trá»ng

### Báº£o máº­t:
- âœ… Chá»‰ admin má»›i cÃ³ quyá»n CRUD voucher
- âœ… MÃ£ voucher tá»± Ä‘á»™ng chuyá»ƒn thÃ nh chá»¯ hoa
- âœ… Validate táº¥t cáº£ input trÆ°á»›c khi lÆ°u
- âŒ KhÃ´ng cho phÃ©p mÃ£ voucher trÃ¹ng

### Best Practices:
- ğŸ“ Äáº·t tÃªn mÃ£ voucher dá»… nhá»›, cÃ³ Ã½ nghÄ©a
- ğŸ“… Thiáº¿t láº­p thá»i háº¡n há»£p lÃ½
- ğŸ’° CÃ¢n nháº¯c giÃ¡ trá»‹ giáº£m vÃ  Ä‘Æ¡n tá»‘i thiá»ƒu
- ğŸ“Š Theo dÃµi sá»‘ lÆ°á»£ng cÃ²n láº¡i
- ğŸ”„ VÃ´ hiá»‡u hÃ³a thay vÃ¬ xÃ³a voucher Ä‘Ã£ dÃ¹ng

### Troubleshooting:
- **Voucher khÃ´ng Ã¡p dá»¥ng Ä‘Æ°á»£c?**
  - Kiá»ƒm tra tráº¡ng thÃ¡i Active
  - Kiá»ƒm tra thá»i háº¡n
  - Kiá»ƒm tra sá»‘ lÆ°á»£ng cÃ²n láº¡i
  - Kiá»ƒm tra Ä‘Æ¡n hÃ ng tá»‘i thiá»ƒu

- **KhÃ´ng thá»ƒ táº¡o voucher?**
  - MÃ£ voucher Ä‘Ã£ tá»“n táº¡i
  - Thiáº¿u thÃ´ng tin báº¯t buá»™c
  - GiÃ¡ trá»‹ khÃ´ng há»£p lá»‡
  - NgÃ y khÃ´ng há»£p lÃ½

---

## ğŸ”§ TÃ­ch há»£p vá»›i Checkout

Khi user Ã¡p dá»¥ng voucher:
```java
firestoreManager.getVoucherByCode("NEWYEAR2025", new OnVoucherLoadedListener() {
    @Override
    public void onVoucherLoaded(Voucher voucher) {
        // TÃ­nh giáº£m giÃ¡
        double discount = 0;
        if ("fixed".equals(voucher.getType())) {
            discount = voucher.getAmount();
        } else if ("percent".equals(voucher.getType())) {
            discount = orderTotal * voucher.getAmount() / 100;
            if (discount > voucher.getMaxDiscount()) {
                discount = voucher.getMaxDiscount();
            }
        }
        
        // Ãp dá»¥ng vÃ  increment usedCount
        applyDiscount(discount);
        firestoreManager.incrementVoucherUsedCount(voucher.getId());
    }
    
    @Override
    public void onError(String error) {
        showError(error);
    }
});
```

---

## ğŸ“Š BÃ¡o cÃ¡o & Thá»‘ng kÃª (TÆ°Æ¡ng lai)

### TÃ­nh nÄƒng má»Ÿ rá»™ng:
- ğŸ“ˆ Thá»‘ng kÃª voucher Ä‘Æ°á»£c sá»­ dá»¥ng nhiá»u nháº¥t
- ğŸ’° Tá»•ng tiá»n giáº£m giÃ¡ theo voucher
- ğŸ‘¥ Sá»‘ ngÆ°á»i dÃ¹ng sá»­ dá»¥ng má»—i voucher
- ğŸ“… Biá»ƒu Ä‘á»“ sá»­ dá»¥ng theo thá»i gian
- ğŸ¯ Tá»· lá»‡ chuyá»ƒn Ä‘á»•i cá»§a voucher

---

**Version**: 1.0  
**Last Updated**: December 2024  
**Author**: Fashion Store Team

---

## ğŸ“ Há»— trá»£

Náº¿u gáº·p váº¥n Ä‘á»:
1. Kiá»ƒm tra Firestore Rules
2. Xem Logcat Ä‘á»ƒ debug
3. Äáº£m báº£o cÃ³ quyá»n admin
4. Kiá»ƒm tra káº¿t ná»‘i Firebase

**Happy Coding! ğŸ‰**
